<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Check Downloads</title>
  </head>
  <body>
    <h3>Total Downloads is:</h3>
    <p id="totalDownloads"></p>

    <input type="button" value="Windows" onclick="totalDownloads()" />
    <input type="button" value="Mac" onclick="totalDownloads()" />

    <script>
      async function totalDownloads() {
        var app = document.getElementById('totalDownloads')
        // get device information
        let device = String(navigator.userAgent)
        let ipAddr = await fetch('https://api.ipify.org?format=json')
        ipAddr = await ipAddr.json()
        const location = await fetch(
          `https://ipapi.co/${ipAddr.ip}/json/`
        );
        const locationData = await location.json();
        console.log("HIiiii")
        console.log(locationData);
        
        const myLocation = navigator.geolocation.getCurrentPosition(
          (position) => {
            console.log(position);
          },
          (error) => {
            console.log(error);
          }
        );

        let data = device + ' ' + ipAddr.ip
        try {
          let res = await fetch('http://localhost:8080/api/download', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              data: data,
            }),
          })
          res = await res.json()

          let displayData = res.download.downloadTimes
          app.innerHTML = displayData
        } catch (error) {
          console.log(error)
        }
      }
    </script>
  </body>
</html>
